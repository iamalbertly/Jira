{"version":3,"names":["IGNORE_CONSOLE_ERRORS","IGNORE_REQUEST_PATTERNS","captureBrowserTelemetry","page","consoleErrors","pageErrors","failedRequests","on","msg","type","text","includes","push","error","message","request","url","shouldIgnore","some","pattern","test","method","failure","errorText","waitForPreview","options","timeout","Promise","race","waitForSelector","state","catch","loadingVisible","locator","isVisible","previewVisible","errorVisible","runDefaultPreview","overrides","projects","start","end","goto","mpsaChecked","masChecked","check","uncheck","fill","click"],"sources":["JiraReporting-Tests-Shared-PreviewExport-Helpers.js"],"sourcesContent":["/**\r\n * SSOT for preview, export, and browser telemetry test flows. Use in E2E, Excel, UX, Column Tooltip, Refactor Validation, Validation Plan, and UX Trust specs.\r\n */\r\n\r\nexport const IGNORE_CONSOLE_ERRORS = [\r\n  'Failed to load resource: the server responded with a status of 404 (Not Found)'\r\n];\r\n\r\nexport const IGNORE_REQUEST_PATTERNS = [\r\n  /\\/favicon\\.ico/i\r\n];\r\n\r\n/**\r\n * Captures browser console errors, page errors, and failed requests for assertion in tests.\r\n * @param {import('@playwright/test').Page} page\r\n * @returns {{ consoleErrors: string[], pageErrors: string[], failedRequests: Array<{ url: string, method: string, failure: string }> }}\r\n */\r\nexport function captureBrowserTelemetry(page) {\r\n  const consoleErrors = [];\r\n  const pageErrors = [];\r\n  const failedRequests = [];\r\n\r\n  page.on('console', msg => {\r\n    if (msg.type() === 'error') {\r\n      const text = msg.text();\r\n      if (!IGNORE_CONSOLE_ERRORS.includes(text)) {\r\n        consoleErrors.push(text);\r\n      }\r\n    }\r\n  });\r\n\r\n  page.on('pageerror', error => {\r\n    pageErrors.push(error.message);\r\n  });\r\n\r\n  page.on('requestfailed', request => {\r\n    const url = request.url();\r\n    const shouldIgnore = IGNORE_REQUEST_PATTERNS.some(pattern => pattern.test(url));\r\n    if (!shouldIgnore) {\r\n      failedRequests.push({\r\n        url,\r\n        method: request.method(),\r\n        failure: request.failure()?.errorText || 'Unknown failure'\r\n      });\r\n    }\r\n  });\r\n\r\n  return { consoleErrors, pageErrors, failedRequests };\r\n}\r\n\r\n/**\r\n * Waits for preview to complete (preview content or error visible, loading hidden).\r\n * @param {import('@playwright/test').Page} page\r\n * @param {{ timeout?: number }} options - optional timeout (default 120000)\r\n */\r\nexport async function waitForPreview(page, options = {}) {\r\n  const timeout = options.timeout ?? 120000;\r\n  await Promise.race([\r\n    page.waitForSelector('#preview-content', { state: 'visible', timeout }).catch(() => null),\r\n    page.waitForSelector('#error', { state: 'visible', timeout }).catch(() => null),\r\n  ]);\r\n  const loadingVisible = await page.locator('#loading').isVisible().catch(() => false);\r\n  if (loadingVisible) {\r\n    await page.waitForSelector('#loading', { state: 'hidden', timeout: 600000 });\r\n  }\r\n  const previewVisible = await page.locator('#preview-content').isVisible().catch(() => false);\r\n  const errorVisible = await page.locator('#error').isVisible().catch(() => false);\r\n  if (!previewVisible && !errorVisible) {\r\n    await Promise.race([\r\n      page.waitForSelector('#preview-content', { state: 'visible', timeout: 10000 }),\r\n      page.waitForSelector('#error', { state: 'visible', timeout: 10000 }),\r\n    ]);\r\n  }\r\n}\r\n\r\n/**\r\n * Runs default preview: go to /report, set projects and date window, click Preview, wait for result.\r\n * @param {import('@playwright/test').Page} page\r\n * @param {{ projects?: string[], start?: string, end?: string }} overrides - optional filter overrides\r\n */\r\nexport async function runDefaultPreview(page, overrides = {}) {\r\n  const {\r\n    projects = ['MPSA', 'MAS'],\r\n    start = '2025-07-01T00:00',\r\n    end = '2025-09-30T23:59',\r\n  } = overrides;\r\n\r\n  await page.goto('/report');\r\n\r\n  const mpsaChecked = projects.includes('MPSA');\r\n  const masChecked = projects.includes('MAS');\r\n  if (mpsaChecked) await page.check('#project-mpsa');\r\n  else await page.uncheck('#project-mpsa');\r\n  if (masChecked) await page.check('#project-mas');\r\n  else await page.uncheck('#project-mas');\r\n\r\n  await page.fill('#start-date', start);\r\n  await page.fill('#end-date', end);\r\n  await page.click('#preview-btn');\r\n\r\n  await Promise.race([\r\n    page.waitForSelector('#loading', { state: 'visible', timeout: 10000 }).catch(() => null),\r\n    page.waitForSelector('#preview-content', { state: 'visible', timeout: 10000 }).catch(() => null),\r\n    page.waitForSelector('#error', { state: 'visible', timeout: 10000 }).catch(() => null),\r\n  ]);\r\n\r\n  await waitForPreview(page);\r\n}\r\n"],"mappings":"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","ignoreList":[]}