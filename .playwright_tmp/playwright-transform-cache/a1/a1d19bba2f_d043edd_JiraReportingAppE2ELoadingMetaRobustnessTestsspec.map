{"version":3,"names":["test","expect","runDefaultPreview","waitForPreview","DEFAULT_Q2_QUERY","describe","page","setTimeout","console","log","previewVisible","locator","isVisible","catch","errorVisible","toBeTruthy","goto","route","Promise","resolve","continue","unroute","consoleMessages","on","msg","type","push","text","evaluate","window","previewData","meta","undefined","exportExcelBtn","isEnabled","click","errorLocator","waitFor","state","timeout","errorText","innerText","toLowerCase","hasMetaReferenceError","some","includes","toBeFalsy","toContain"],"sources":["Jira-Reporting-App-E2E-Loading-Meta-Robustness-Tests.spec.js"],"sourcesContent":["import { test, expect } from '@playwright/test';\r\nimport { runDefaultPreview, waitForPreview } from './JiraReporting-Tests-Shared-PreviewExport-Helpers.js';\r\n\r\nconst DEFAULT_Q2_QUERY = '?projects=MPSA,MAS&start=2025-07-01T00:00:00.000Z&end=2025-09-30T23:59:59.999Z';\r\n\r\ntest.describe('Jira Reporting App - Loading & Meta Robustness E2E', () => {\r\n  test('fast preview completion still reaches a stable state', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Loading/Meta: fast preview completion');\r\n\r\n    await runDefaultPreview(page);\r\n\r\n    const previewVisible = await page.locator('#preview-content').isVisible().catch(() => false);\r\n    const errorVisible = await page.locator('#error').isVisible().catch(() => false);\r\n\r\n    // Either preview or error is acceptable; main point is no hang.\r\n    expect(previewVisible || errorVisible).toBeTruthy();\r\n  });\r\n\r\n  test('slow preview shows loading overlay at least once', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Loading/Meta: slow preview shows loading overlay');\r\n\r\n    await page.goto('/report');\r\n\r\n    // Artificially delay network by intercepting preview call.\r\n    await page.route(`/preview.json${DEFAULT_Q2_QUERY}`, async (route) => {\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n      await route.continue();\r\n    }).catch(() => {});\r\n\r\n    await waitForPreview(page);\r\n\r\n    // Even if we missed the exact timing, loading should have been present at some point.\r\n    // We assert that the page is no longer in a \\\"stuck\\\" state by checking preview/error.\r\n    const previewVisible = await page.locator('#preview-content').isVisible().catch(() => false);\r\n    const errorVisible = await page.locator('#error').isVisible().catch(() => false);\r\n    expect(previewVisible || errorVisible).toBeTruthy();\r\n\r\n    await page.unroute(`/preview.json${DEFAULT_Q2_QUERY}`).catch(() => {});\r\n  });\r\n\r\n  test('missing meta does not cause ReferenceError and shows clear message', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Loading/Meta: missing meta handled gracefully');\r\n\r\n    const consoleMessages = [];\r\n    page.on('console', (msg) => {\r\n      if (msg.type() === 'error') {\r\n        consoleMessages.push(msg.text());\r\n      }\r\n    });\r\n\r\n    await runDefaultPreview(page);\r\n\r\n    const previewVisible = await page.locator('#preview-content').isVisible().catch(() => false);\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping missing meta scenario');\r\n      return;\r\n    }\r\n\r\n    // Simulate missing meta and try to re-render export path\r\n    await page.evaluate(() => {\r\n      // @ts-ignore\r\n      if (window.previewData) {\r\n        // @ts-ignore\r\n        window.previewData.meta = undefined;\r\n      }\r\n    });\r\n\r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      await exportExcelBtn.click();\r\n\r\n      const errorLocator = page.locator('#error');\r\n      await errorLocator.waitFor({ state: 'visible', timeout: 10000 }).catch(() => null);\r\n      const errorText = (await errorLocator.innerText().catch(() => ''))?.toLowerCase() || '';\r\n\r\n      // No ReferenceError: meta is not defined should appear in the console.\r\n      const hasMetaReferenceError = consoleMessages.some(msg =>\r\n        msg.toLowerCase().includes('referenceerror') && msg.toLowerCase().includes('meta')\r\n      );\r\n      expect(hasMetaReferenceError).toBeFalsy();\r\n\r\n      if (errorText) {\r\n        expect(errorText).toContain('export error');\r\n        expect(errorText).toContain('metadata');\r\n      }\r\n    }\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}