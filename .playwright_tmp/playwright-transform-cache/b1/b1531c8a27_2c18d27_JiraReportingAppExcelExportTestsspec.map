{"version":3,"names":["test","expect","runDefaultPreview","EXPORT_TIMEOUT_MS","DIALOG_TIMEOUT_MS","clickExcelExportAndWait","page","timeout","downloadPromise","waitForEvent","dialogPromise","then","dialog","accept","catch","click","loadWorkbookFromDownload","download","path","readFileSync","buffer","ExcelJS","default","workbook","Workbook","xlsx","load","describe","beforeEach","goto","locator","toContainText","setTimeout","console","log","previewVisible","isVisible","exportExcelBtn","isEnabled","filename","suggestedFilename","filenamePattern","toMatch","storiesSheet","getWorksheet","headerRow","getRow","dateColumns","eachCell","includeEmpty","cell","colNumber","colName","value","toString","includes","push","name","length","rowCount","dataRow","forEach","getCell","isDate","Date","toBeTruthy","map","c","join","headers","not","toContain","hasTicketID","some","h","hasSprintStartDate","hasEpicID","kpiColumns","isValid","hasEpicIDManual","hasEpicNameManual","hasIsReworkManual","hasIsBugManual","hasTeamNotes","summarySheet","toBeGreaterThan","allValues","eachRow","row","hasOverview","v","hasKeyMetrics","hasDataQuality","metadataSheet","hasExportDate","hasDateRange","hasProjects","exportBtn","epicsSheet","firstDataRow","epicIDCell","sprintsSheet","sprintIDCell","evaluate","window","previewData","meta","undefined","errorLocator","errorPromise","waitFor","state","type","result","Promise","race","errorText","innerText","toLowerCase","skip","route","fulfill","status","contentType","body","JSON","stringify","error","unroute"],"sources":["Jira-Reporting-App-Excel-Export-Tests.spec.js"],"sourcesContent":["/**\r\n * Excel Export Validation Tests\r\n * Tests Excel export functionality including file naming, multi-tab structure,\r\n * business-friendly column names, Excel-compatible dates, and KPI calculations\r\n */\r\n\r\nimport { test, expect } from '@playwright/test';\r\nimport { runDefaultPreview } from './JiraReporting-Tests-Shared-PreviewExport-Helpers.js';\r\n\r\nconst EXPORT_TIMEOUT_MS = 60000;\r\nconst DIALOG_TIMEOUT_MS = 5000;\r\n\r\nasync function clickExcelExportAndWait(page, timeout = EXPORT_TIMEOUT_MS) {\r\n  const downloadPromise = page.waitForEvent('download', { timeout });\r\n  const dialogPromise = page\r\n    .waitForEvent('dialog', { timeout: DIALOG_TIMEOUT_MS })\r\n    .then(async (dialog) => {\r\n      await dialog.accept();\r\n    })\r\n    .catch(() => null);\r\n\r\n  await page.click('#export-excel-btn');\r\n  await dialogPromise;\r\n  return downloadPromise;\r\n}\r\nasync function loadWorkbookFromDownload(download) {\r\n  const path = await download.path();\r\n  const { readFileSync } = await import('fs');\r\n  const buffer = readFileSync(path);\r\n  const ExcelJS = (await import('exceljs')).default;\r\n  const workbook = new ExcelJS.Workbook();\r\n  await workbook.xlsx.load(buffer);\r\n  return workbook;\r\n}\r\n\r\ntest.describe('Jira Reporting App - Excel Export Tests', () => {\r\n  test.beforeEach(async ({ page }) => {\r\n    await page.goto('/report');\r\n    await expect(page.locator('h1')).toContainText('VodaAgileBoard');\r\n  });\r\n\r\n  test('should generate Excel file with correct filename format', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing Excel filename format');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping Excel filename test');\r\n      return;\r\n    }\r\n    \r\n    // Click Excel export button\r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS);\r\n\r\n      if (download) {\r\n        const filename = download.suggestedFilename();\r\n        // Verify filename pattern: {Projects}_{DateRange}_{Type}_{Date}.xlsx\r\n        const filenamePattern = /^[A-Z-]+_(Q[1-4]-\\d{4}|\\d{4}-\\d{2}-\\d{2}_to_\\d{4}-\\d{2}-\\d{2})_Sprint-Report_\\d{4}-\\d{2}-\\d{2}\\.xlsx$/;\r\n        expect(filename).toMatch(filenamePattern);\r\n        console.log(`[TEST] Excel filename format correct: ${filename}`);\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should have Excel-compatible date formats', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing Excel date formats');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping Excel date format test');\r\n      return;\r\n    }\r\n    \r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS);\r\n      \r\n      if (download) {\r\n        const workbook = await loadWorkbookFromDownload(download);\r\n        \r\n        // Check Stories sheet for date columns\r\n        const storiesSheet = workbook.getWorksheet('Stories');\r\n        if (storiesSheet) {\r\n          const headerRow = storiesSheet.getRow(1);\r\n          const dateColumns = [];\r\n          \r\n          headerRow.eachCell({ includeEmpty: false }, (cell, colNumber) => {\r\n            const colName = cell.value;\r\n            if (colName && (colName.toString().includes('Date') || colName.toString().includes('date'))) {\r\n              dateColumns.push({ name: colName, colNumber });\r\n            }\r\n          });\r\n          \r\n          // Check that date cells are Date objects or formatted correctly\r\n          if (dateColumns.length > 0 && storiesSheet.rowCount > 1) {\r\n            const dataRow = storiesSheet.getRow(2);\r\n            dateColumns.forEach(({ name, colNumber }) => {\r\n              const cell = dataRow.getCell(colNumber);\r\n              if (cell.value) {\r\n                // Date should be a Date object or formatted string\r\n                const isDate = cell.value instanceof Date || (typeof cell.value === 'string' && /^\\d{4}-\\d{2}-\\d{2}/.test(cell.value));\r\n                expect(isDate || cell.value === '').toBeTruthy();\r\n              }\r\n            });\r\n            console.log(`[TEST] ✓ Excel date columns formatted correctly: ${dateColumns.map(c => c.name).join(', ')}`);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should have business-friendly column names', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing business-friendly column names');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping column names test');\r\n      return;\r\n    }\r\n    \r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS);\r\n      \r\n      if (download) {\r\n        const workbook = await loadWorkbookFromDownload(download);\r\n        \r\n        // Check Stories sheet headers\r\n        const storiesSheet = workbook.getWorksheet('Stories');\r\n        if (storiesSheet) {\r\n          const headerRow = storiesSheet.getRow(1);\r\n          const headers = [];\r\n          headerRow.eachCell({ includeEmpty: false }, (cell) => {\r\n            headers.push(cell.value.toString());\r\n          });\r\n          \r\n          // Verify business-friendly names (not technical names)\r\n          expect(headers).not.toContain('issueKey'); // Should be 'Ticket ID'\r\n          expect(headers).not.toContain('sprintStartDate'); // Should be 'Sprint Start Date'\r\n          expect(headers).not.toContain('epicKey'); // Should be 'Epic ID'\r\n          \r\n          // Verify business-friendly names exist\r\n          const hasTicketID = headers.some(h => h.includes('Ticket ID'));\r\n          const hasSprintStartDate = headers.some(h => h.includes('Sprint Start Date'));\r\n          const hasEpicID = headers.some(h => h.includes('Epic ID'));\r\n          \r\n          if (hasTicketID || hasSprintStartDate || hasEpicID) {\r\n            console.log('[TEST] ✓ Excel contains business-friendly column names');\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should calculate KPI columns correctly', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing KPI column calculations');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping KPI calculations test');\r\n      return;\r\n    }\r\n    \r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS);\r\n      \r\n      if (download) {\r\n        const workbook = await loadWorkbookFromDownload(download);\r\n        \r\n        // Check Stories sheet for KPI columns\r\n        const storiesSheet = workbook.getWorksheet('Stories');\r\n        if (storiesSheet) {\r\n          const headerRow = storiesSheet.getRow(1);\r\n          const kpiColumns = [];\r\n          \r\n          headerRow.eachCell({ includeEmpty: false }, (cell, colNumber) => {\r\n            const colName = cell.value.toString();\r\n            if (colName.includes('Work Days') || colName.includes('Cycle Time') || colName.includes('Days Since')) {\r\n              kpiColumns.push({ name: colName, colNumber });\r\n            }\r\n          });\r\n          \r\n          if (kpiColumns.length > 0) {\r\n            console.log(`[TEST] ✓ Excel contains KPI columns: ${kpiColumns.map(c => c.name).join(', ')}`);\r\n            \r\n            // Verify KPI columns have numeric values (if data exists)\r\n            if (storiesSheet.rowCount > 1) {\r\n              const dataRow = storiesSheet.getRow(2);\r\n              kpiColumns.forEach(({ name, colNumber }) => {\r\n                const cell = dataRow.getCell(colNumber);\r\n                // KPI values should be numbers or empty strings\r\n                const isValid = cell.value === '' || typeof cell.value === 'number';\r\n                expect(isValid).toBeTruthy();\r\n              });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should include manual enrichment columns', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing manual enrichment columns');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping manual enrichment test');\r\n      return;\r\n    }\r\n    \r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS);\r\n      \r\n      if (download) {\r\n        const workbook = await loadWorkbookFromDownload(download);\r\n        \r\n        const storiesSheet = workbook.getWorksheet('Stories');\r\n        if (storiesSheet) {\r\n          const headerRow = storiesSheet.getRow(1);\r\n          const headers = [];\r\n          headerRow.eachCell({ includeEmpty: false }, (cell) => {\r\n            headers.push(cell.value.toString());\r\n          });\r\n          \r\n          // Verify manual enrichment columns exist\r\n          const hasEpicIDManual = headers.some(h => h.includes('Epic ID (Manual)'));\r\n          const hasEpicNameManual = headers.some(h => h.includes('Epic Name (Manual)'));\r\n          const hasIsReworkManual = headers.some(h => h.includes('Is Rework (Manual)'));\r\n          const hasIsBugManual = headers.some(h => h.includes('Is Bug (Manual)'));\r\n          const hasTeamNotes = headers.some(h => h.includes('Team Notes'));\r\n          \r\n          if (hasEpicIDManual || hasEpicNameManual || hasIsReworkManual || hasIsBugManual || hasTeamNotes) {\r\n            console.log('[TEST] ✓ Excel contains manual enrichment columns');\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should contain Summary tab with key metrics', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing Summary tab content');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping Summary tab test');\r\n      return;\r\n    }\r\n    \r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS);\r\n      \r\n      if (download) {\r\n        const workbook = await loadWorkbookFromDownload(download);\r\n        \r\n        const summarySheet = workbook.getWorksheet('Summary');\r\n        if (summarySheet) {\r\n          // Check that Summary sheet has data\r\n          expect(summarySheet.rowCount).toBeGreaterThan(1);\r\n          \r\n          // Check for key sections\r\n          const allValues = [];\r\n          summarySheet.eachRow((row) => {\r\n            row.eachCell({ includeEmpty: false }, (cell) => {\r\n              allValues.push(cell.value.toString());\r\n            });\r\n          });\r\n          \r\n          const hasOverview = allValues.some(v => v.includes('Overview') || v.includes('Total Stories'));\r\n          const hasKeyMetrics = allValues.some(v => v.includes('Key Metrics') || v.includes('Story Points'));\r\n          const hasDataQuality = allValues.some(v => v.includes('Data Quality'));\r\n          \r\n          if (hasOverview || hasKeyMetrics || hasDataQuality) {\r\n            console.log('[TEST] ✓ Summary tab contains key sections');\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should contain Metadata tab with export context', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing Metadata tab content');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping Metadata tab test');\r\n      return;\r\n    }\r\n    \r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS);\r\n      \r\n      if (download) {\r\n        const workbook = await loadWorkbookFromDownload(download);\r\n        \r\n        const metadataSheet = workbook.getWorksheet('Metadata');\r\n        if (metadataSheet) {\r\n          expect(metadataSheet.rowCount).toBeGreaterThan(1);\r\n          \r\n          // Check for key metadata fields\r\n          const allValues = [];\r\n          metadataSheet.eachRow((row) => {\r\n            row.eachCell({ includeEmpty: false }, (cell) => {\r\n              allValues.push(cell.value.toString());\r\n            });\r\n          });\r\n          \r\n          const hasExportDate = allValues.some(v => v.includes('Export Date') || v.includes('Export Time'));\r\n          const hasDateRange = allValues.some(v => v.includes('Date Range'));\r\n          const hasProjects = allValues.some(v => v.includes('Projects'));\r\n          \r\n          if (hasExportDate || hasDateRange || hasProjects) {\r\n            console.log('[TEST] ✓ Metadata tab contains export context');\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should handle Project & Epic Level tab export', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing Project & Epic Level tab export');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping Project & Epic Level export test');\r\n      return;\r\n    }\r\n    \r\n    // Navigate to Project & Epic Level tab\r\n    await page.click('.tab-btn[data-tab=\"project-epic-level\"]');\r\n    \r\n    // Check for export button\r\n    const exportBtn = page.locator('.export-section-btn[data-section=\"project-epic-level\"]');\r\n    if (await exportBtn.isVisible()) {\r\n      const downloadPromise = page.waitForEvent('download', { timeout: 15000 }).catch(() => null);\r\n      await exportBtn.click();\r\n      const download = await downloadPromise;\r\n      \r\n      if (download) {\r\n        console.log('[TEST] ✓ Project & Epic Level tab export works');\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should validate Excel workbook data before sending to server', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing Excel export validation');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping validation test');\r\n      return;\r\n    }\r\n    \r\n    // Validation happens client-side before fetch, so we test that export works\r\n    // (which implies validation passed)\r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS).catch(() => null);\r\n      \r\n      if (download) {\r\n        console.log('[TEST] ✓ Excel export validation passed (export succeeded)');\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should show placeholder messages in empty Excel tabs', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing empty Excel tabs with placeholder messages');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping empty tabs test');\r\n      return;\r\n    }\r\n    \r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS).catch(() => null);\r\n      \r\n      if (download) {\r\n        const workbook = await loadWorkbookFromDownload(download);\r\n        \r\n        // Check Epics sheet for placeholder message if empty\r\n        const epicsSheet = workbook.getWorksheet('Epics');\r\n        if (epicsSheet && epicsSheet.rowCount > 1) {\r\n          const firstDataRow = epicsSheet.getRow(2);\r\n          const epicIDCell = firstDataRow.getCell(1);\r\n          if (epicIDCell.value && epicIDCell.value.toString().includes('No Epic TTM data available')) {\r\n            console.log('[TEST] ✓ Empty Epics sheet shows placeholder message');\r\n          }\r\n        }\r\n        \r\n        // Check Sprints sheet for placeholder message if empty\r\n        const sprintsSheet = workbook.getWorksheet('Sprints');\r\n        if (sprintsSheet && sprintsSheet.rowCount > 1) {\r\n          const firstDataRow = sprintsSheet.getRow(2);\r\n          const sprintIDCell = firstDataRow.getCell(1);\r\n          if (sprintIDCell.value && sprintIDCell.value.toString().includes('No sprint data available')) {\r\n            console.log('[TEST] ✓ Empty Sprints sheet shows placeholder message');\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should show file size warning for large Excel exports', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing file size warning (may not trigger with test data)');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping file size warning test');\r\n      return;\r\n    }\r\n    \r\n    // File size warning only appears for very large files (>50MB)\r\n    // Test data may not be large enough, so we just verify export works\r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      // Note: File size warning uses confirm() dialog which is hard to test in Playwright\r\n      // We verify export works, which implies either no warning or user confirmed\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS).catch(() => null);\r\n      \r\n      if (download) {\r\n        console.log('[TEST] ✓ Excel export works (file size warning may not have triggered with test data)');\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should show improved error messages for Excel export failures', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing improved error messages');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping error message test');\r\n      return;\r\n    }\r\n    \r\n    // Error messages are tested implicitly when export succeeds\r\n    // For explicit error testing, we'd need to mock server failures\r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const download = await clickExcelExportAndWait(page, EXPORT_TIMEOUT_MS).catch(() => null);\r\n      \r\n      if (download) {\r\n        console.log('[TEST] ✓ Excel export error handling works (export succeeded)');\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should block Excel export with clear error when preview meta is missing', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing export behavior when preview meta is missing');\r\n    \r\n    await runDefaultPreview(page);\r\n    \r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping missing meta export test');\r\n      return;\r\n    }\r\n\r\n    // Simulate a broken preview payload where meta is missing\r\n    await page.evaluate(() => {\r\n      // @ts-ignore\r\n      if (window.previewData) {\r\n        // @ts-ignore\r\n        window.previewData.meta = undefined;\r\n      }\r\n    });\r\n\r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const dialogPromise = page\r\n        .waitForEvent('dialog', { timeout: DIALOG_TIMEOUT_MS })\r\n        .then(async (dialog) => {\r\n          await dialog.accept();\r\n        })\r\n        .catch(() => null);\r\n\r\n      await exportExcelBtn.click();\r\n      await dialogPromise;\r\n      const errorLocator = page.locator('#error');\r\n      const errorPromise = errorLocator\r\n        .waitFor({ state: 'visible', timeout: 10000 })\r\n        .then(() => ({ type: 'error' }))\r\n        .catch(() => null);\r\n      const downloadPromise = page\r\n        .waitForEvent('download', { timeout: 10000 })\r\n        .then(download => ({ type: 'download', download }))\r\n        .catch(() => null);\r\n\r\n      const result = await Promise.race([errorPromise, downloadPromise]);\r\n      if (result?.type == 'error') {\r\n        const errorText = (await errorLocator.innerText())?.toLowerCase() || '';\r\n        expect(errorText).toContain('export error');\r\n        expect(errorText).toContain('metadata');\r\n        console.log('[TEST] ? Export blocked with clear error when preview meta is missing');\r\n      } else if (result?.type == 'download') {\r\n        console.log('[TEST] ? Export succeeded without meta (fallback path)');\r\n      } else {\r\n        test.skip();\r\n      }\r\n    }\r\n  });\r\n\r\n  test('should show specific error message when server returns 500 for Excel export', async ({ page }) => {\r\n    test.setTimeout(180000);\r\n    console.log('[TEST] Testing Excel export server error handling (500)');\r\n\r\n    await runDefaultPreview(page);\r\n\r\n    const previewVisible = await page.locator('#preview-content').isVisible();\r\n    if (!previewVisible) {\r\n      console.log('[TEST] Preview not visible, skipping server error export test');\r\n      return;\r\n    }\r\n\r\n    // Force /export-excel to return a 500 error\r\n    await page.route('/export-excel', async (route) => {\r\n      await route.fulfill({\r\n        status: 500,\r\n        contentType: 'application/json',\r\n        body: JSON.stringify({ error: 'Simulated failure' }),\r\n      });\r\n    });\r\n\r\n    const exportExcelBtn = page.locator('#export-excel-btn');\r\n    if (await exportExcelBtn.isEnabled()) {\r\n      const dialogPromise = page\r\n        .waitForEvent('dialog', { timeout: DIALOG_TIMEOUT_MS })\r\n        .then(async (dialog) => {\r\n          await dialog.accept();\r\n        })\r\n        .catch(() => null);\r\n\r\n      await exportExcelBtn.click();\r\n      await dialogPromise;\r\n\r\n      const errorLocator = page.locator('#error');\r\n      await errorLocator.waitFor({ state: 'visible', timeout: 10000 });\r\n      const errorText = (await errorLocator.innerText())?.toLowerCase() || '';\r\n\r\n      expect(errorText).toContain('export error');\r\n      expect(errorText).toContain('server error during excel generation');\r\n      console.log('[TEST] ✓ Excel export shows specific error when server returns 500');\r\n    }\r\n\r\n    // Clean up route so other tests are not affected\r\n    await page.unroute('/export-excel');\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}