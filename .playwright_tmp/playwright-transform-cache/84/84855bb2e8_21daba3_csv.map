{"version":3,"names":["CSV_COLUMNS","escapeCSVField","value","undefined","str","String","hasSpecial","includes","escaped","replace","cleaned","generateCSVClient","columns","rows","lines","push","map","join","row","values","col","streamCSV","response","setHeader","header","write","line","end"],"sources":["csv.js"],"sourcesContent":["/**\r\n * Fixed column order for drill-down dataset\r\n */\r\nexport const CSV_COLUMNS = [\r\n  'projectKey',\r\n  'boardId',\r\n  'boardName',\r\n  'sprintId',\r\n  'sprintName',\r\n  'sprintState',\r\n  'sprintStartDate',\r\n  'sprintEndDate',\r\n  'issueKey',\r\n  'issueSummary',\r\n  'issueStatus',\r\n  'issueType',\r\n  'issueStatusCategory',\r\n  'issuePriority',\r\n  'issueLabels',\r\n  'issueComponents',\r\n  'issueFixVersions',\r\n  'assigneeDisplayName',\r\n  'created',\r\n  'updated',\r\n  'resolutionDate',\r\n  'subtaskCount',\r\n  'timeOriginalEstimateHours',\r\n  'timeRemainingEstimateHours',\r\n  'timeSpentHours',\r\n  'timeVarianceHours',\r\n  'subtaskTimeOriginalEstimateHours',\r\n  'subtaskTimeRemainingEstimateHours',\r\n  'subtaskTimeSpentHours',\r\n  'subtaskTimeVarianceHours',\r\n  'ebmTeam',\r\n  'ebmProductArea',\r\n  'ebmCustomerSegments',\r\n  'ebmValue',\r\n  'ebmImpact',\r\n  'ebmSatisfaction',\r\n  'ebmSentiment',\r\n  'ebmSeverity',\r\n  'ebmSource',\r\n  'ebmWorkCategory',\r\n  'ebmGoals',\r\n  'ebmTheme',\r\n  'ebmRoadmap',\r\n  'ebmFocusAreas',\r\n  'ebmDeliveryStatus',\r\n  'ebmDeliveryProgress',\r\n  'storyPoints',\r\n  'epicKey',\r\n  'epicTitle',\r\n  'epicSummary',\r\n];\r\n\r\n/**\r\n * Escapes a CSV field value (SSOT: matches client escape rules for contract consistency)\r\n * Handles comma, quote, newline, tab, carriage return, and control characters.\r\n * @param {any} value - Value to escape\r\n * @returns {string} - Escaped CSV field\r\n */\r\nfunction escapeCSVField(value) {\r\n  if (value === null || value === undefined) {\r\n    return '';\r\n  }\r\n\r\n  const str = String(value);\r\n  const hasSpecial = str.includes(',') || str.includes('\"') || str.includes('\\n') ||\r\n    str.includes('\\r') || str.includes('\\t');\r\n  if (hasSpecial) {\r\n    const escaped = str.replace(/\"/g, '\"\"').replace(/\\r\\n/g, ' ').replace(/\\n/g, ' ').replace(/\\r/g, ' ');\r\n    return `\"${escaped}\"`;\r\n  }\r\n  const cleaned = str.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\r\n  return cleaned;\r\n}\r\n\r\n/**\r\n * Generates CSV string from columns and rows (client-side)\r\n * @param {string[]} columns - Column names\r\n * @param {Array<Object>} rows - Array of row objects\r\n * @returns {string} - CSV string\r\n */\r\nexport function generateCSVClient(columns, rows) {\r\n  const lines = [];\r\n\r\n  // Header row\r\n  lines.push(columns.map(escapeCSVField).join(','));\r\n\r\n  // Data rows\r\n  for (const row of rows) {\r\n    const values = columns.map(col => escapeCSVField(row[col]));\r\n    lines.push(values.join(','));\r\n  }\r\n\r\n  return lines.join('\\n');\r\n}\r\n\r\n/**\r\n * Streams CSV to HTTP response (server-side)\r\n * @param {string[]} columns - Column names\r\n * @param {Array<Object>} rows - Array of row objects\r\n * @param {Object} response - Express response object\r\n */\r\nexport function streamCSV(columns, rows, response) {\r\n  response.setHeader('Content-Type', 'text/csv; charset=utf-8');\r\n  response.setHeader('Content-Disposition', 'attachment; filename=\"jira-report.csv\"');\r\n\r\n  // Write header\r\n  const header = columns.map(escapeCSVField).join(',') + '\\n';\r\n  response.write(header);\r\n\r\n  // Stream rows\r\n  for (const row of rows) {\r\n    const values = columns.map(col => escapeCSVField(row[col]));\r\n    const line = values.join(',') + '\\n';\r\n    response.write(line);\r\n  }\r\n\r\n  response.end();\r\n}\r\n"],"mappings":"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","ignoreList":[]}